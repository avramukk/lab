
#!/bin/bash

# Variable for the HLS stream URL
STREAM_URL="$1"

# Using ffprobe to get frame data
ffprobe -hide_banner -show_frames -show_entries frame=pkt_pts_time,pkt_pos,pkt_size "$STREAM_URL" 2>/dev/null | \
    # Parsing the output
    while IFS= read -r line; do
        # Looking for the start of a frame
        if [[ $line == "[FRAME]" ]]; then
            unset PTS POS SIZE # Clear variables for the new frame
        elif [[ $line == *pkt_pts_time=* ]]; then
            PTS="${line#*=}" # Store PTS of the frame
        elif [[ $line == *pkt_pos=N/A* ]]; then
            POS="N/A" # Mark the absence of POS
        elif [[ $line == *pkt_size=* ]]; then
            SIZE="${line#*=}" # Store the size of the frame
        elif [[ $line == "[/FRAME]" ]]; then
            # If POS is not defined, log this frame as problematic
            if [[ $POS == "N/A" ]]; then
                echo "Problematic frame: PTS=$PTS, pkt_pos=$POS, pkt_size=$SIZE"
            fi
        fi
    done
